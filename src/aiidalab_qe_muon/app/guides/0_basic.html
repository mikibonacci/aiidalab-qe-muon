<div id="guide-header">
  You've activated the muon in-app guide. In this guide, you will learn how to
  use the app to find the muon resting sites of Lithium Fluoride (LiF). <br>
  Click on <b>Step 1: Select structure</b> and follow the instructions to proceed.
</div>

<div id="structure-step">
  In the structure selection step, we select the LiF structure by querying it 
  from the OPTIMADE database. <br>
  Once selected, we can view the structure in the viewer below. We can also edit
  the structure using the available structure editors. When done, we can choose
  to modify the structure label and/or provide a description. These will be
  attached to the input structure node in your AiiDA database.
  <div class="alert alert-success">
    <h4>Tasks</h4>
  <ul>
    <li><b>Open</b> the OPTIMADE structure selector: click on the OPTIMADE tab and then click on load the "Load OPTIMADE widget" button</li>
    <li><b>Select</b> the provider: look for "Materials Cloud" in the first dropdown, and then select the "MC3D" database in the second one</li>
    <li><b>Query</b> for LiF: select Li and F elements in the interactive periodic table, and click the "Search" blue button</li>
    <li><b>Select</b> the LiF structure: click on the first result ("FLi (id=22852)")</li>
    <li>Click the <b>Confirm</b> button to proceed</li>
  </ul>
    <div class="alert alert-warning">
      <b>Warning:</b> If the confirmed structure is not yet stored in the AiiDA
      database, it will be stored automatically when you proceed to the next
      step.
    </div>
    <div class="alert alert-warning">
      <b>Warning:</b> Changes after confirmation will reset the following steps.
    </div>
  </div>
</div>

<div id="configuration-step">
  In the configuration step, we define the parameters needed to perform our search for muon stopping sites.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Select <b>Structure as is</b>, i.e. no relaxation (it will be done with the muon inside)</li>
      <li>Open <b>step 2.1</b> for further instructions</li>
    </ol>
  </div>
</div>

<div id="properties-selection">
  Here we select the properties to calculate. Each property is associated with a
  workflow that will submit one or more calculations.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Check <b>Muon Spectroscopy (MUON)</b></li>
      <li>Open <b>step 2.2</b> for further instructions</li>
    </ol>
  </div>
</div>

<div id="calculation-settings">
  Here we can customize the calculation parameters. The settings are divided
  into several tabs:
  <ul>
    <li><b>Basic settings</b>: top-level calculation settings</li>
    <li><b>Advanced settings</b>: fine-tune the calculations</li>
    <li>
      <b>Plugin settings</b>: parameters for plugin calculations including
      muon settings
    </li>
  </ul>
  Note that the app pre-configures defaults for most parameters.
  <div class="alert alert-success">
    See further instructions in the <b>Muon settings</b> panel below.
  </div>
</div>

<div id="muon-settings">
  In the Muon settings panel, we can customize the muon parameters. 
  We leave some of the parameters as default ones. We will use value of the parameters
  in such a way to quickly perform simulation, not to obtain accurate results. For example, 
  we are not going to use a supercell, and we are using a coarser K-points grid with respect to the
  default one.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ul>
    <li><h5>Muon <b>sites search</b> settings:</h5></li>
      <ul>
        <li>Set the <b>K-points distance</b> to be 0.9 Å<sup>-1</sup>, so we have a Mesh grid [3, 3, 3]</li>
        <li>Set the <b>Spacing for trial grid for initial muon sites</b> to 0.7 Å<sup>-1</sup></li>
        <li>Click the <b>estimate number of muon trial sites</b> to verify that we have 3 candidate sites</li>
        <li>Click the <b>Visualize candidate muon sites</b> to see them in the unit cell</li>
      </ul>
    <li><h5>Muon spin <b>polarization</b> settings:</h5></li>
      <ul>
        <li>Change the <b>B<sub>step</sub></b> to be 4, so that the below field list will be [0, 4, 8]</li>
      </ul>
    <li>Click the <b>Submit</b> button to proceed</li>
    </ul>
    <div class="alert alert-warning">
      <b>Warning:</b> Changes after confirmation will reset the following steps.
    </div>
  </div>
</div>

<div id="submission-step">
  <p>
    In the submission step, we define the computational resources to be used in
    the calculations. The global resources are used to define resources across
    all workflow calculations. Optionally, you can override the resource
    settings for specific calculations.
  </p>
  <div class="alert alert-warning">
    <b>Warning:</b> If running locally (for example, on the AiiDAlab demo
    server), we recommend keeping nodes and CPUs at the default minimum of 1
    each.
  </div>
  <p>
    Once the resources are defined, we can optionally customize the workflow
    label (pre-filled according to the settings of steps 1 & 2), as well as
    provide a detailed description of the workflow. Once we are ready, we can
    submit the workflow.
  </p>
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Select 1 node and 1 CPU for each of the codes below</li>
      <li><b>(Optional)</b> customize the workflow label</li>
      <li><b>(Optional)</b> add a workflow description</li>
      <li>Click the <b>Submit</b> button to proceed</li>
    </ol>
    <div class="alert alert-warning">
      <b>Warning:</b> The workflow may take a moment to submit.
    </div>
  </div>
</div>

<div id="results-panel">
  Here in the results panel, each tab will open results pertaining to a specific
  calculation submitted by the workflow.
  <div class="alert alert-success">
    See further instructions below in the <b>Muon results</b> tab.
  </div>
</div>

<div id="muon-stopping-sites-results">
  When muon results are available, the <b>Load results</b> button will become active allowing us to
  load the results from AiiDA.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>
        Once the calculation is complete, click on the
        <b>Load results</b> button to load the available results
      </li>
      <li>
        Check the table and, for the lowest energy sites, check the distance between the &mu; and the 
        nearest F atom, by selecting them in the structure viewer (it should be 1.15 Å).
      </li>
      <li>
        Verify that indeed closest F atoms are attracted by the muon center, whereas the Li atoms are repelled;
        This can be easily seen in the Distortion panel, below the structure viewer.
      </li>
      <li>
        Perform similar analysis for site D: select it from the table. You will notice that the structure will change,
        being now the one hosting the muon site D.
      </li>
      <li>
        Check the distance between the two lowest energy muons by ticking the "Compare muon sites mode" and 
        selecting them from the table.
      </li>
      <li>
        Untick the "Compare muon sites mode" to go back to the single site visualization mode.
      </li>
    </ol>
  </div>
</div>

<div id="muon-undi-results">
  Here below we can plot the polarization data for all the detected muon sites. 
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>
        Check the relaxation function for site D (selecting it from the above table, if necessary), and verify that the signal at zero field (ZF) is different from the 
        Kubo-Toyabe one. At which time does the relaxation function start to deviate from the Kubo-Toyabe one?
      </li>
      <li>
        Verify that the polarization function is converged for max<sub>hdim</sub> > 10<sup>2</sup>. This can be seen in the 
        "Convergence analysis" panel.
      </li>
    </ol>
  </div>
</div>

<div id="post-guide">
  <h4>Post-guide exercises</h4>
  <ol>
    <li>
      Download the data on muon stopping sites:
      <ul>
        <li>
          Click the "Download data" button just below the table in inspect the contained files; 
          try to visualize the cif files with your favorite visualization software (e.g., <a
              href="https://jp-minerals.org/vesta/en/"
              target="_blank"
            >
              VESTA</a
            >).
          </li>
      </ul>
    </li>
    <li>
      Download the polarization data for the muon stopping site B and plot it with a software of your choice, 
      to verify that indeed it is the same you see in this app.
    </li>
    <li>
      Run the same calculation for muon search site but include also a second grid of field for the polarization, adding
      two additional fields: 50 and 100 mT. You will have to play with the B step carefully (and check the B fields list).
      You can also make a coarser grid for the 0 - 8 mT range (e.g. imposing a B step of 4 mT).
    </li>
  </ol>
</div>
