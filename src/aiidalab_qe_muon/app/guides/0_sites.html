<div id="guide-header">
  You've activated the muon in-app guide. <br>
  In this guide, you will learn how to
  use the app to find the <b>muon resting sites</b> of Lithium Fluoride (LiF). <br>
  <div class="alert alert-warning">
    <b>Pre-requisite:</b> This guide assumes that you already followed the general &rarr; basic guide, or that you are already familiar with the app.
  </div>
  Click on <b>Step 1: Select structure</b> and follow the instructions to proceed.
</div>

<div id="structure-step">
  In the structure selection step, we select the LiF structure by querying it 
  from the OPTIMADE database. <br>
  <div class="alert alert-success">
    <h4>Tasks</h4>
  <ul>
    <li><b>Open</b> the OPTIMADE structure selector: click on the OPTIMADE tab and then click on load the "Load OPTIMADE widget" button</li>
    <li><b>Select</b> the provider: look for "Materials Cloud" in the first dropdown, and then select the "MC3D" database in the second one</li>
    <li><b>Query</b> for LiF: select Li and F elements in the interactive periodic table, and click the "Search" blue button (at the bottom)</li>
    <li><b>Select</b> the LiF structure: click on the first result ("FLi (id=22852)"), or, if already selected, continue to the next step</li>
    <li>In the <b>Edit structure</b> &rarr; <b>Edit cell</b> tab, select <b>Convert to conventional cell</b></li>
    <li>Click the <b>Confirm</b> button to proceed</li>
  </ul>
    <div class="alert alert-warning">
      <b>Warning:</b> If the confirmed structure is not yet stored in the AiiDA
      database, it will be stored automatically when you proceed to the next
      step.
    </div>
    <div class="alert alert-warning">
      <b>Warning:</b> Changes after confirmation will reset the following steps.
    </div>
  </div>
</div>

<div id="configuration-step">
  In the configuration step, we define the parameters needed to perform our search for muon stopping sites in LiF.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Select <b>Structure as is</b>, i.e. no relaxation (it is performed during the search for muon sites)</li>
      <li>Open <b>Step 2.1</b> for further instructions</li>
    </ol>
  </div>
</div>

<div id="basic-settings">
  Here we define the basic settings of the simulations.
  <div class="alert alert-success">
    <h4>Tasks</h4>
      <ol>
        <li>Select <b>Insulator</b> Electronic type</li>
        <li>Select <b>Fast</b> protocol</li>
        <li>See further instructions in the <b>Muon settings</b> panel</li>
      </ol>
  </div>
  <div class="alert alert-warning">
    <b>Note:</b> For the purpose of completing this guide in short time, we will use the <b>Fast</b> protocol for default parameters.
    However, you if dispose of enough computational resources, you can also select Moderate or Precise.
  </div>
</div>

<div id="properties-selection">
  Here we select the properties to calculate. Each property is associated with a
  workflow that will submit one or more calculations.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Select the <b>Muon Spectroscopy (MUON)</b> checkbox</li>
      <li>Open <b>Step 2.2</b> for further instructions</li>
    </ol>
  </div>
</div>

<div id="calculation-settings">
  Here we can customize the calculation parameters. The settings are divided
  into several tabs:
  <ul>
    <li><b>Basic settings</b>: top-level calculation settings</li>
    <li><b>Advanced settings</b>: fine-tune the calculations</li>
    <li>
      <b>Plugin settings</b>: parameters for plugin calculations including
      muon settings
    </li>
  </ul>
  Note that the app pre-configures defaults for most parameters.
</div>

<div id="muon-settings">
  In the Muon settings panel, we can customize the muon parameters. 
  We will use value of the parameters
  in such a way to quickly perform simulation, not to obtain accurate results. For example, 
  we are not going to use a large enough supercell, and we are using a much coarser K-points grid with respect to the
  default one.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ul>
    <li><h5>Muon <b>sites search</b> settings:</h5></li>
      <ul>
        <li>De-select the <b>Compute polarization</b> checkbox</li>
        <li>Set the <b>K-points distance</b> to be 2 Å<sup>-1</sup>, so we have a k-points mesh grid of [1, 1, 1] (we compute only the &Gamma; point)</li>
        <li>Click the <b>estimate number of muon trial sites</b> button to verify that we have 3 candidate sites</li>
        <li>Click the <b>Visualize candidate muon sites</b> button to see them in the unit cell</li>
      </ul>
    <li>Click the <b>Confirm</b> button to proceed</li>
    </ul>
    <div class="alert alert-warning">
      <b>Warning:</b> Changes after confirmation will reset the following steps.
    </div>
  </div>
</div>

<div id="submission-step">
  <p>
    In the submission step, we define the computational resources to be used in
    the calculations. The global resources are used to define resources across
    all workflow calculations. Optionally, you can override the resource
    settings for specific calculations.
  </p>
  <div class="alert alert-warning">
    <b>Warning:</b> If running locally (for example, on the AiiDAlab demo
    server), we recommend keeping nodes and CPUs at the default minimum of 1
    each.
  </div>
  <p>
    Once the resources are defined, we can optionally customize the workflow
    label (pre-filled according to the settings of steps 1 & 2), as well as
    provide a detailed description of the workflow. Once we are ready, we can
    submit the workflow.
  </p>
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>Select 1 node and 1 CPU for each of the codes below</li>
      <li><b>(Optional)</b> customize the workflow label</li>
      <li><b>(Optional)</b> add a workflow description</li>
      <li>Click the <b>Submit</b> button to proceed</li>
    </ol>
    <div class="alert alert-warning">
      <b>Warning:</b> The workflow may take a moment to submit.
    </div>
  </div>
</div>

<div id="results-step">
  In the results panel, each tab will open results pertaining to a specific
  calculation submitted by the workflow.
  <div class="alert alert-success">
    See further instructions below in the <b>Muon</b> results tab.
  </div>
</div>

<div id="muon-stopping-sites-results">
  When muon results are available, the <b>Load results</b> button will become active allowing us to
  load the results from AiiDA.
  <div class="alert alert-success">
    <h4>Tasks</h4>
    <ol>
      <li>
        Once the calculation is complete, click on the
        <b>Load results</b> button to load the available results
      </li>
      <li>
        Check the <b>table</b> and, for the lowest energy site (label is A), compute the distance between the &mu; and the 
        nearest F atom, by <b>selecting the atoms</b> (the &mu; being the white one) in the structure viewer below the table. The measured distance should be 1.15 Å, 
        and it is displayed in the panel on the right with respect to the structure view.
      </li>
      <li>
        Verify that indeed the closest F atoms are attracted by the muon center, whereas the Li atoms are repelled;
        This can be easily seen in the <b>Distortion</b> plot, below the structure viewer.
      </li>
      <li>
        Perform similar analysis for site C: select the corresponding row in the table. The structure below will change,
        being now the one hosting the muon site C.
      </li>
      <li>
        Check the distance between the muons A and C by ticking the <b>Compare muon sites mode</b> and 
        selecting the rows in the table.
      </li>
      <li>
        Untick the "Compare muon sites mode" to go back to the single site visualization mode.
      </li>
    </ol>
  </div>
</div>

<div id="post-guide">
  <h4>Post-guide exercises</h4>
  <ol>
    <li>
      Download the data on muon stopping sites:
      <ul>
        <li>
          Click on the <b>Download data</b> button just below the table and inspect the contained files; 
          you can open the cif files with your favorite visualization software (e.g., <a
              href="https://jp-minerals.org/vesta/en/"
              target="_blank"
            >
              VESTA</a
            >).
          </li>
      </ul>
    </li>
    <li>
      Use the app to run the muon stopping site search for the same system (LiF), this time for the neutral muon (or muonium). 
      This means that, in the settings, you need to select the <b>Muon charge state</b> to be <b>Muonium (neutral)</b> 
      <ul>
        <li>Use the same parameters settings of this example</li>
        <li>Do you see differences in the results, especially in the &mu; - F distances? Why?</li>
      </ul>
    </li>
  </ol>
</div>
